<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Mystery NFT Reveal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
        }
        
        .container {
            padding-top: 2rem;
        }
        
        .mystery-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 1rem;
        }
        
        .nft-image {
            width: 200px;
            height: 200px;
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        
        .mystery-shimmer {
            background: linear-gradient(90deg, #333 25%, #666 50%, #333 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .reveal-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .reveal-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .connect-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .alert {
            border-radius: 10px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="text-center mb-5">
                    <h1 class="text-white mb-3">
                        <i class="fas fa-magic"></i> Mystery Alchemist Reveal
                    </h1>
                    <p class="text-white-50">Connect your wallet to reveal your mystery NFTs</p>
                </div>

                <!-- Wallet Connection -->
                <div class="mystery-card text-center" id="wallet-section">
                    <h3 class="text-white mb-3">Connect Your Wallet</h3>
                    <p class="text-white-50 mb-4">Connect your Solflare or Phantom wallet to get started</p>
                    <button class="connect-button" onclick="connectWallet()">
                        <i class="fas fa-wallet"></i> Connect Wallet
                    </button>
                    <button class="btn btn-outline-warning btn-sm mt-2" onclick="debugWallet()">
                        <i class="fas fa-bug"></i> Debug Wallet
                    </button>
                    <div class="mt-3">
                        <small class="text-white-50">Connected: <span id="wallet-address">Not connected</span></small>
                    </div>
                </div>

                <!-- NFT Display -->
                <div class="mystery-card" id="nft-section" style="display: none;">
                    <h3 class="text-white text-center mb-4">
                        <i class="fas fa-gem"></i> Your Mystery NFTs
                    </h3>
                    <div id="nft-list" class="row">
                        <!-- NFTs will be displayed here -->
                    </div>
                </div>

                <!-- Messages -->
                <div class="alert alert-info" id="message" style="display: none;"></div>
                <div class="alert alert-danger" id="error-message" style="display: none;"></div>
                <div class="alert alert-success" id="success-message" style="display: none;"></div>

                <!-- Loading -->
                <div class="text-center" id="loading" style="display: none;">
                    <div class="spinner-border text-light" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="text-white mt-2" id="loading-text">Loading...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    
    <script>
        let wallet = null;
        let connection = null;

        function showMessage(message, type = 'info') {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.className = `alert alert-${type} alert-dismissible fade show`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function showLoading(message) {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('loading-text').textContent = message;
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        async function connectWallet() {
            try {
                showLoading('Connecting wallet...');
                
                if (window.solflare) {
                    console.log('Connecting to Solflare...');
                    const response = await window.solflare.connect();
                    
                    if (response === true) {
                        // Try to get public key using the same method as the main site
                        let publicKey = null;
                        
                        try {
                            const accountsResponse = await window.solflare.request({ method: 'getAccounts' });
                            if (accountsResponse && accountsResponse.length > 0) {
                                publicKey = accountsResponse[0];
                                console.log('‚úÖ Found publicKey via getAccounts');
                            }
                        } catch (e) {
                            console.log('‚ùå getAccounts failed:', e.message);
                        }
                        
                        if (!publicKey) {
                            try {
                                const accountInfoResponse = await window.solflare.request({ method: 'getAccountInfo' });
                                if (accountInfoResponse && accountInfoResponse.publicKey) {
                                    publicKey = accountInfoResponse.publicKey;
                                    console.log('‚úÖ Found publicKey via getAccountInfo');
                                }
                            } catch (e) {
                                console.log('‚ùå getAccountInfo failed:', e.message);
                            }
                        }
                        
                        if (!publicKey) {
                            try {
                                const walletResponse = await window.solflare.request({ method: 'getWallet' });
                                if (walletResponse && walletResponse.publicKey) {
                                    publicKey = walletResponse.publicKey;
                                    console.log('‚úÖ Found publicKey via getWallet');
                                }
                            } catch (e) {
                                console.log('‚ùå getWallet failed:', e.message);
                            }
                        }
                        
                        if (!publicKey) {
                            try {
                                const addressResponse = await window.solflare.request({ method: 'getAddress' });
                                if (addressResponse) {
                                    publicKey = addressResponse;
                                    console.log('‚úÖ Found publicKey via getAddress');
                                }
                            } catch (e) {
                                console.log('‚ùå getAddress failed:', e.message);
                            }
                        }
                        
                        if (publicKey) {
                            wallet = publicKey;
                            connection = new solanaWeb3.Connection('https://api.devnet.solana.com', 'confirmed');
                            console.log('‚úÖ Solflare connected successfully:', wallet.toString());
                            onWalletConnected();
                        } else {
                            // Final fallback: try to get from window.solflare directly
                            console.log('üîç Trying final fallback...');
                            if (window.solflare.publicKey) {
                                wallet = window.solflare.publicKey;
                                connection = new solanaWeb3.Connection('https://api.devnet.solana.com', 'confirmed');
                                console.log('‚úÖ Solflare connected via fallback:', wallet.toString());
                                onWalletConnected();
                            } else {
                                throw new Error('Connected but could not get wallet address. Please check if Solflare is properly connected.');
                            }
                        }
                    } else {
                        throw new Error('Unexpected response from Solflare: ' + response);
                    }
                } else if (window.solana && window.solana.isPhantom) {
                    console.log('Connecting to Phantom...');
                    const response = await window.solana.connect();
                    wallet = response.publicKey;
                    connection = new solanaWeb3.Connection('https://api.devnet.solana.com', 'confirmed');
                    onWalletConnected();
                } else {
                    throw new Error('No Solana wallet found. Please install Solflare or Phantom.');
                }
                
            } catch (error) {
                console.error('Connection error:', error);
                hideLoading();
                showError('Failed to connect wallet: ' + error.message);
            }
        }

        function onWalletConnected() {
            hideLoading();
            document.getElementById('wallet-address').textContent = wallet.toString();
            document.getElementById('wallet-section').style.display = 'none';
            document.getElementById('nft-section').style.display = 'block';
            
            showMessage('Wallet connected successfully!', 'success');
            
            // For now, show a demo NFT since we don't have Metaplex
            showDemoNFTs();
        }

        function showDemoNFTs() {
            const nftList = document.getElementById('nft-list');
            
            // Show a demo mystery NFT
            nftList.innerHTML = `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="mystery-card text-center">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjNjY2NjY2Ii8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+TXlzdGVyeSBBbGNoZW1pc3Q8L3RleHQ+Cjwvc3ZnPgo=" 
                             alt="Mystery NFT" class="nft-image mystery-shimmer">
                        <h5 class="text-white">Mystery Alchemist #DEMO</h5>
                        <p class="text-white-50">Status: Mystery</p>
                        <button class="reveal-button" onclick="revealNFT()">
                            <i class="fas fa-magic"></i> Reveal NFT
                        </button>
                    </div>
                </div>
            `;
        }

        async function revealNFT() {
            try {
                showLoading('Revealing your mystery alchemist...');
                
                // Simulate reveal process
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                hideLoading();
                showMessage('NFT revealed successfully! (Demo mode)', 'success');
                
                // Update the NFT display
                const nftList = document.getElementById('nft-list');
                nftList.innerHTML = `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="mystery-card text-center">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjNENBRjUwIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+UmV2ZWFsZWQgQWxjaGVtaXN0PC90ZXh0Pgo8L3N2Zz4K" 
                                 alt="Revealed NFT" class="nft-image">
                            <h5 class="text-white">Revealed Alchemist #DEMO</h5>
                            <p class="text-white-50">Status: Revealed</p>
                            <p class="text-white-50">Trait: Fire Element</p>
                            <button class="reveal-button" disabled>
                                <i class="fas fa-check"></i> Already Revealed
                            </button>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                hideLoading();
                showError('Failed to reveal NFT: ' + error.message);
            }
        }

        // Debug function to check wallet status
        function debugWallet() {
            console.log('üîç Debugging wallet connection...');
            console.log('window.solflare:', window.solflare);
            console.log('window.solana:', window.solana);
            
            if (window.solflare) {
                console.log('‚úÖ Solflare detected');
                console.log('isConnected:', window.solflare.isConnected);
                console.log('publicKey:', window.solflare.publicKey);
            } else {
                console.log('‚ùå Solflare not detected');
            }
            
            if (window.solana) {
                console.log('‚úÖ window.solana detected');
                console.log('isPhantom:', window.solana.isPhantom);
                console.log('isSolflare:', window.solana.isSolflare);
                console.log('isConnected:', window.solana.isConnected);
                console.log('publicKey:', window.solana.publicKey);
            } else {
                console.log('‚ùå window.solana not detected');
            }
            
            showMessage('Check browser console for debug info', 'info');
        }
        
        // Check for existing connection on page load
        window.addEventListener('load', async () => {
            if (window.solflare && window.solflare.isConnected) {
                try {
                    const accountsResponse = await window.solflare.request({ method: 'getAccounts' });
                    if (accountsResponse && accountsResponse.length > 0) {
                        wallet = accountsResponse[0];
                        connection = new solanaWeb3.Connection('https://api.devnet.solana.com', 'confirmed');
                        onWalletConnected();
                    }
                } catch (e) {
                    console.log('No existing connection');
                }
            }
        });
    </script>
</body>
</html>
